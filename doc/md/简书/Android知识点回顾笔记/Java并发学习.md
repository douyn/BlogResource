Java多线程学习

## 前言

## 概念
###### 进程 
进程是应用程序在计算机上的一次执行过程。是系统进行资源分配和调度的一个独立单位。
###### 线程
线程是进程的一个实体，是CPU调度和分派的基本单位，他是比进程更小的能独立运行的基本单位。
###### 进程和线程的区别
* 进程间互相独立，同一进程的多个线程间可以共享数据
* 进程有自己的独立空间，线程必须以来进程存在
* 进程间通信需要IPC机制，线程间通信可以直接共享数据

举个栗子：

车间和生产线

一个车间能够执行生产任务，他就是一个进程，这个车间里有很多生产线相互协调工作，就是线程。
###### Android IPC
多进程造成的问题：
* 静态成员和单例模式完全失效
* 线程同步机制失效
* SharePreference可靠性降低
* Application会被创建多次

进程间通信的方法：
* 通过intent传递Bundle数据
* 通过共享文件
* 基于Binder的Messenger
* AIDL
* ContentProvider
* Socket
###### 并发
同一时间段一个cpu执行多段逻辑
###### 并行
同一时刻多个CPU同时执行一段逻辑
###### 线程安全
在多线程中，线程的调度顺序不影响任何结果，那么这段代码就是线程安全的。
###### 同步
Java中的同步指的是通过认为的分配或者调度，使得共享资源的多线程成为线程安全。线程安全优先级高于性能。
###### 多线程
多个线程同时执行。

为什么要使用多线程？

优点：
* 充分使用cpu资源。 单线程意味着只能在一个cpu上执行，其他的cpu将被闲置。多线程可以在多个cpu上执行，充分利用cpu的资源。
* 结构优雅。 多线程可以将一段复杂的代码分成若干能能模块，每个模块实现单一功能。这将使程序的建模和测试更加方便，逻辑清晰，代码优雅。
* 简化异步处理。 为了避免阻塞，单线程必须使用非阻塞I/O，这样的I/O复杂性远远高于同步I/O，并且容易出错。

缺点：
* 线程安全。 由于同一进程下的各个线程是共享同样的空间地址和数据，由由于线程执行顺序的不确定性，一个线程可能会修改正在使决数据被篡改的问题，例如加锁。
* 活跃性问题。 可能会发生长时间的等待锁或者死锁。
* 性能问题。 线程频繁调度切换会浪费资源，同步机制会造成内存缓冲区的数据无效。

线程安全问题的解决机制？
* 加锁。　锁能使其保护的代码以串行的形式来访问，当给一个复杂的操作加锁后，能使其成为原子类。同时加锁要多所有有共享数据的方法进行加锁，不要给没有共享状态的代码加锁，这样会影响性能。
* 不共享状态。　如果没有共享的状态标志，那么在多线程环境下将不会相互影响。
* 不可变对象。　使用final修饰符。

###### 线程池

###### 线程队列

###### 生产者/消费者模型

线程锁
## 线程的状态
![线程状态转换图](http://upload-images.jianshu.io/upload_images/1689841-383f7101e6588094.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&_=5479442)
线程被创建会进入new状态，执行start后会进入runnable状态等待cpu使用权，如果获得cpu的执行权，就会进入running状态，run方法执行完毕或者异常退出都会进行Dead状态，这是正常的线程执行状态流程。

下边是线程在Running状态下可能遇到的阻塞情况:
* 调用join()或者sleep()方法。在sleep时间结束或者sleep被打断或者join结束都会重新进入runnable状态。
* 如果线程被上锁，其他线程就被放入lock blocked pool,等待获取锁，其他线程释放掉锁后进入runnable状态。
* 如果线程被上锁，调用wait()方法。会使这个线程释放掉锁，并进入wait blocked poll,直到线程被唤醒，会被放到lock blocked pool，等待获取锁，其他线程释放同步锁后进入Runnable状态。

## 线程的操作

##### synchronized

##### wait()

##### notify()/notifyAll()

##### 生产者消费者问题

## 基本线程类
##### Runnable接口

##### Thread类

##### Callable接口
## 高级线程控制类

## 附加(多线程/线程池/线程队列)

## 总结

## 参考
[Java中的多线程你只要看这一篇就够了](http://www.cnblogs.com/wxd0108/p/5479442.html)
